<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Plugain - Reklam Ä°zle</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #222;
      --accent-color: #6200ea;
      --card-bg: #ffffff;
    }

    body.dark-mode {
      --bg-color: #121212;
      --text-color: #eee;
      --card-bg: #1e1e1e;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--card-bg);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }

    .container {
      max-width: 400px;
      margin: 40px auto;
      background-color: var(--card-bg);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.07);
      text-align: center;
    }

    h2 {
      margin-bottom: 20px;
      color: var(--accent-color);
    }

    p {
      font-size: 1.1rem;
      margin: 10px 0;
    }

    #watch-ad {
      background-color: var(--accent-color);
      color: white;
      border: none;
      border-radius: 30px;
      padding: 15px 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s, background 0.3s;
    }

    #watch-ad:hover {
      background-color: #7e33e4;
      transform: scale(1.05);
    }

    #watch-ad:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    #countdown {
      margin-top: 15px;
      font-weight: bold;
      color: var(--accent-color);
    }

    #dark-toggle {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: var(--accent-color);
    }

    #dark-toggle:hover {
      transform: rotate(20deg) scale(1.2);
    }

    @media (max-width: 500px) {
      .container {
        margin: 20px;
        padding: 20px;
      }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <span><strong>PlugainCoin:</strong> <span id="plugain-coin">0</span></span>
    <button id="dark-toggle">ðŸŒ“</button>
  </div>

  <div class="container">
    <h2>Reklam Ä°zle ve Puan Kazan</h2>
    <p><strong>KullanÄ±cÄ± AdÄ±:</strong> <span id="user-name">YÃ¼kleniyor...</span></p>
    <p><strong>TÄ±klama SayÄ±sÄ±:</strong> <span id="click-count">YÃ¼kleniyor...</span></p>
    <p><strong>PuanlarÄ±nÄ±z:</strong> <span id="user-points">YÃ¼kleniyor...</span></p>

    <button id="watch-ad">Reklam Ä°zle</button>
    <div id="countdown"></div>
  </div>

  <script>
    const firebaseConfig = {
      databaseURL: "https://plugain-1f481-default-rtdb.europe-west1.firebasedatabase.app/"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const uid = params.get('uid');

    const userNameEl = document.getElementById("user-name");
    const clickCountEl = document.getElementById("click-count");
    const userPointsEl = document.getElementById("user-points");
    const plugainCoinEl = document.getElementById("plugain-coin");
    const watchAdBtn = document.getElementById("watch-ad");
    const countdownEl = document.getElementById("countdown");

    if (!uid) {
      document.body.innerHTML = "<h2 style='text-align:center; color:red;'>KullanÄ±cÄ± ID'si (uid) URL'de bulunamadÄ±.<br>Telegram Ã¼zerinden tekrar giriÅŸ yap.</h2>";
      throw new Error("UID yok.");
    }

    const userRef = db.ref("users/" + uid);

    function updateCountdown(timestamp) {
      const lastClick = new Date(timestamp);
      const nextAvailable = new Date(lastClick.getTime() + 24 * 60 * 60 * 1000);
      const now = new Date();

      const diff = nextAvailable - now;

      if (diff > 0) {
        watchAdBtn.disabled = true;
        const hours = Math.floor(diff / 3600000);
        const minutes = Math.floor((diff % 3600000) / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        countdownEl.textContent = `Yeni tÄ±klama iÃ§in geri sayÄ±m: ${hours}sa ${minutes}dk ${seconds}sn`;
        setTimeout(() => updateCountdown(timestamp), 1000);
      } else {
        watchAdBtn.disabled = false;
        countdownEl.textContent = '';
      }
    }

    userRef.once("value").then((snapshot) => {
      if (!snapshot.exists()) {
        userRef.set({
          name: "KullanÄ±cÄ±",
          clickCount: 0,
          points: 0,
          plugainCoin: 0,
          lastClick: null
        });
      } else {
        const data = snapshot.val();
        userNameEl.textContent = data.name || "KullanÄ±cÄ±";
        clickCountEl.textContent = data.clickCount || 0;
        userPointsEl.textContent = data.points || 0;
        plugainCoinEl.textContent = data.plugainCoin || 0;
        if (data.lastClick) updateCountdown(data.lastClick);
      }
    });

    watchAdBtn.addEventListener("click", () => {
      userRef.once("value").then(snapshot => {
        const data = snapshot.val();
        const now = new Date().toISOString();
        const newClickCount = (data.clickCount || 0) + 1;
        const newPoints = (data.points || 0) + 10;
        const newCoin = Math.floor(newPoints / 100);

        userRef.update({
          clickCount: newClickCount,
          points: newPoints,
          plugainCoin: newCoin,
          lastClick: now
        });

        clickCountEl.textContent = newClickCount;
        userPointsEl.textContent = newPoints;
        plugainCoinEl.textContent = newCoin;
        updateCountdown(now);
      });
    });

    document.getElementById("dark-toggle").addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
    });
  </script>
</body>
</html>
